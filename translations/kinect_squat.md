## 파이썬을 이용한 운동 자세 즉석 평가

### 소개 

건강한 라이프스타일은 평범한 운동에 달려있다. 그러나 많은 훈련자들은 올바르지 못한 운동 자세로 고통받고 있고, 부상의 위험성을 늘이며 운동이 주는 건강의 이득을 감소시키고 있다. 올바른 자세의 정립은 일반적으로 퍼스널 트레이너가 필요하다. 우리는 그것을 머신러닝으로 해결하고자 한다.

우리는 일반적인 하체운동인 맨몸스쿼트에 집중하여 이 문제를 해결하고자 한다. 우리의 목적은 Kinect v2 에서 얻어진 움직임 데이터를 이용하여 훈련자가 어떠한 자세의 측면을 더욱 향상시킬 수 있을지 예측하는것이다.

우리는 독립형 binary 나 다항 classifier을 만들기 위해 스쿼트 구성요소 classifier 묶음 (깊이, 무릎이 발끝을 넘지 않는지 등등의 classifier)을 사용하고, 운동 자세의 구성요소가 좋은지 나쁜지 판별할 수 있다. (다항 classifier 에서는 자세의 어떤 면에서 나쁜지) 

또한 우리는 우리의 시스템이 다른 운동에서도 쉽게 적용될 수 있음을 보이기 위해 푸시업 자세 평가도 지원하므로서 분류 파이프라인을 확장할 것이다. 

### 관련된 작업들 

키넥트는 이미 재활운동 분야의 자세 분석에서도 쓰이고 있고, 어느정도의 성공을 거두었다. 그러한 실험들은 운동들을 분류했으며, 키넥트에서 제공하는 골격 좌표를 매핑하여 자동화된 데이터 수집 도구로서 활용되었다.
그러나 이러한 형태의 데이터 수집은 운동 동작을 잘 하고 있는지, 못하고 있는지 등의 특성을 분석하여 실시간 피드백을 제공하지 않으며. 단지 동작의 여러 반복수의 Post-Processing (후처리) 만 가능하게 할 뿐이다.

최근 나이키와 마이크로소프트에서 키넥트를 이용하여 운동 동작을 점수로 평가받는 운동 게임을 만들었다. 그러나 이 플랫폼은 다양한 사이즈의 사용자를 가지고 있으면서, 여러 사이즈를 고려한 좋은 동작의 예시들을 일반화하여 고려하지 않고 하나의 이상적인 자세의 골격 데이터와 패턴 매칭을 하는 방식을 적용했다. 게다가 이 플랫폼은 1개의 갯수에서의 좋은 자세보다는, 사용자가 운동 갯수를 늘리는것을 더 강조했다. 이러한 방식은 운동 자세의 결점을 발견하는 데에는 도움이 되지 않는다.

키넥트는 몸 전체에 걸쳐 다양한 골격 좌표를 얻을 수 있어서 태권도나 무술 훈련 시스템을 디자인하는데에도 도구가 되어 왔다. 그러나 이러한 접근들은 단지 녹화된 프레임과의 유사도를 측정하고, 일일히 수동적으로 허용 오차를 설정하여 무술 테크닉이 좋은 자세인지 나쁜 자세인지 시뮬레이션한다. 그러므로 이러한 시스템은 다양한 크기에 걸친 훈련자들의 광범위한 특성을 쉽게 일반화하지 못한다.

**머신러닝** 또한 인간의 동작 인식과 분류를 위한 골격 데이터를 추출하는데에 사용되어왔다. 관절 요소와 관련하여 동작 어휘를 표현함으로써, Kinect 스트림(연속) 데이터를 개별 동작으로 분석되었고, 각각의 동작은 골격 좌표 구성요소 레벨로서 분류되었다. 이륙 중 사용된 airplane gesture(?) 를 분류하는 연구 사례에서, 서포트 벡터 머신(svm) 과 의사결정 트리(Decision Tree)는 다양한 주제에 걸쳐 적절한 분류에 성과가 있는 것으로 입증되었다.  
특히 공간 문제의 유사성을 고려할 때 (일반적으로 키넥트 스트림을 개별 요소 구성 단위로 분류하는 것) 이러한 접근방식의 성공은 키넥트 기반 운동동작 분석 시스템을 디자인하는데 동기를 부여해 주었다. 
Activity Recognition 은 역도 운동동작 분석에서 이용되어 왔지만, 정확한 피드백을 위해 다양한 웨어러블 장비가 필요했다. 우리의 접근방식은 키넥트를 유일한 비침습 센서(몸을 건들지 않는) 로 사용하여, 사용자에게 동작 갯수 하나당의 피드백을 제공하고. 다양한 표준 운동에 대한 파이프라인을 가능하게 하는 것을 목표로 한다.


### 데이터셋과 Feature
우리 목표의 참신함 때문에, 우리는 프로젝트에 사용할 적절한 데이터셋을 찾을 수 없었다. 우리는 40명에 가까운 지원자로부터 250개의 스쿼트 데이터와 100개의 푸시업 데이터를 수집하고 라벨을 붙였다. 이를 위해 우리는 키넥트 v2 를 사용하여 10개의 스쿼트와 푸시업을 녹화했고 25개 관절의 x,y,z 공간좌표를 추출했다.
우리는 raw 한 시간 연속 데이터를 개별 반복으로 분할하는 알고리즘을 작성했다. 이 분할 후, 각 반복을 x,y,z 축에 대한 단위 범위가 있는 좌표계로 표준화했다. 우리는 각 반복의 라벨을 우리가 설정한 8개의 컴포넌트 classifier 에 해당하는 8개의 카테고리로 분류하였다. 이중 무릎이 발끝을 넘지 않는지, 고관절과 무릎이 동시에 접히는지, 스쿼트 깊이, 척추 각도와 고관절 각도, 스탠스 : 5가지 컴포넌트가 유용하다고 밝혀졌다. 불일치를 최소화하기 위해 동일한 검토자가 컴포넌트의 모든 라벨에 대해 책임졌다.

<img width="798" alt="스크린샷 2019-08-23 오전 11 43 01" src="https://user-images.githubusercontent.com/26560119/63563268-78468100-c59b-11e9-948e-2dc24aa9d724.png">

Feature 을 추출하기 위해 주어진 반복에서 r-discrete frames 을 선택하고, 해당 프레임의 관절 좌표를 사용하여 다양한 Feature를 계산한다. 여기서 r은 각 컴포넌트 classifer에 대해 별도로 조정한 프레임 분석용 하이퍼 파라미터이다. 우리는 피트니스 서적을 기반으로 각 컴포넌트의 feature 을 디자인했다. 우리는 우리의 전체 Feture set에서 가장 잘 동작하는 컴포넌트 classifier 들을 발견했다. 반면 나머지 classifier 들은 우리가 해당 컴포넌트에 대해서 특별히 디자인한 feature 들에서 잘 동작했다. 이중 공통 feature는 주요 프레임(예를 들어 스쿼트 최하지점) 관절간 각도, 시간에 따른 각도 변화, 주요 프레임에서 규격화된 관절의 위치, 시간에 따른 위치변화 그리고 관절간 거리였다. 우리가 확보한 모든 데이터에서 각각의 feature 의 값 집합은 단위 분산 및 0 평균으로 정규화 되었다. 